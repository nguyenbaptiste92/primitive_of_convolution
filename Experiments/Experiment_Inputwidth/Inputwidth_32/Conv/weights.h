#include "nnom.h"

#define CONV2D_KERNEL_0 {24, -34, -56, 11, -42, -66, 10, 43, -22, -55, -72, 52, -65, -65, 54, 3, -59, 71, -44, 23, 68, -72, 2, 56, 28, -63, -67, 41, -48, -70, 49, 65, -8, -32, 4, 23, -19, 36, -8, 25, 7, -6, 61, 27, -19, 53, 65, 70, -7, -25, 73, 51, -44, 18, 46, -16, 45, -12, -61, -42, -44, 26, 7, -70, -65, 72, 27, -41, 59, 60, -2, 7, 43, 3, 50, 68, 66, -48, 63, 57, 28, -7, 17, 49, 21, 23, -18, -7, 15, -66, 2, 18, 6, 57, -17, 66, -6, -3, 41, 54, -27, 26, 57, -25, -26, -14, 3, 39, -13, 36, 42, 41, -26, -55, -19, -8, -51, 38, 57, 8, -38, 33, 31, -9, -52, 3, 44, 42, -12, -38, 8, 20, 4, 41, -45, 43, 45, 21, 29, 60, -6, 54, 35, 0, -41, 44, 18, -22, -30, -61, 40, -54, 52, 10, 51, 43, -48, -47, -71, -52, -56, 52, -35, 65, 35, -60, 24, -66, 53, -19, -42, 47, 33, -5, -14, 12, 25, -14, 43, -36, 65, 50, 54, 42, 45, 6, 42, -17, 67, -59, 49, -31, -24, -40, 35, 63, 54, 27, -4, 7, 23, 67, 68, -60, 24, -14, 36, -48, 29, -51, 71, 71, 53, -36, 63, -20, 26, -27, 2, 51, 25, 26, 19, -20, -15, -35, -70, -70, 32, 32, -43, 33, 67, 31, -10, 59, 49, 63, -60, 22, 49, -40, 5, -33, 16, -38, 33, -54, -10, 16, 70, 67, 43, -10, -5, 25, 52, 15, -66, -57, 54, -48, 73, -40, -69, -5, -22, -31, -15, 67, 54, -54, -20, 39, 28, 33, -74, 27, 71, 22, 4, -60, -50, 57, -42, -65, 37, -7, -35, 46, -28, -58, -27, 41, 43, 59, -42, 38, 73, -13, 29, 53, -60, 21, -27, -58, 46, 66, 11, -24, -67, -67, -56, 47, 56, -5, -12, 71, -11, -21, -8, -31, 9, 60, 73, -47, -74, 2, 12, 59, -33, -23, 26, 47, -72, -52, 20, -66, -29, -8, -50, -26, 30, -6, -65, 37, 2, -41, -16, -3, -23, -40, 50, -8, 32, 29, 47, -39, 36, 17, -59, 66, -17, 15, 42, -70, -54, 73, -9, -30, -3, 56, 4, 8, -26, 37, 70, -50, -9, -2, 47, 17, -34, -38, -26, -26, -60, 26, -56, 72, 14, -54, -10, -70, -28, -31, -25, -63, -49, 56, -17, -69, 33, -60, 3, -13, -67, -23, 72, 43, -35, -43, -29, -28, 46, 16, -65, -26, -62, 47, 44, -44, -7, -14, -66, -60, -14, -26, 24, -24, -25, -10, -36, -4, -37, -4, -5, -72, -26, -11, -53, 43, -19, -2, 41, 45, -42, -48, 4, -1, 12, -15, 61, 71, 41, 29, 0, 28, -35, -2, 15, -72, 39, -12, 18, 30, 64, -39, -43, -60, -19, 28, -27, -9, 28, 73, -29, 41, 65, -73, -67, -57, 28, 57, -12, 45, 10, -42, 17, -23, -4, -42, -28, 37, -58, 15, -52, -41, -45, 2, 32, 2, 62, 70, 36, 35, 14, 23, -25, -19, 17, -61, -65, 25, 3, -16, -14, 67, -4, -23, 58, 14, -48, 23, -52, 44, -42, -66, 62, -72, 72, -71, 25, -12, 48, 20, 39, 35, 68, -47, 59, -62, 4, -60, -43, -37, 32, -8, -65, 3, -26, -25, -48, 72, -45, -48, 14, -36, -4, 69, 56, 62, 18, 9, -28, 74, -56, 61, 15, 14, 10, 58, -19, -36, -71, -61, 31, 35, 59, -49, -5, 21, -40, 6, -4, -22, -28, -34, -67, -28, -1, 25, 63, 66, -29, -7, 70, -28, 50, -47, 36, 8, 35, -31, -19, 50, 72, -23, -1, -11, -49, 63, 60, -35, 42, -38, -54, 56, 62, 53, 32, -18, 3, -50, 7, 32, 52, 22, -54, 72, -16, 33, 68, -56, -20, -5, 35, 27, -10, 73, 69, -2, 22, 1, 30, 40, 51, -10, 49, 8, -42, -13, 25, 37, -19, 25, 28, -62, 36, -33, 26, -9, -61, 35, -55, 32, -67, 42, -54, -29, -38, -73, -38, 8, -44, 63, -47, -3, -58, 43, -68, 27, -19, 15, 26, 2, -1, 5, 29, -53, -40, -22, -56, -36, 39, 38, 24, 1, -41, -9, -15, 54, -48, 43, -38, 39, 39, -67, 5, -68, -38, 7, -45, -62, -34, -72, 15, 71, -51, -51, 69, -57, 45, 6, -61, 52, 73, 1, -22, 66, -70, 6, -1, -7, -18, -9, 27, -8, 72, -73, 9, 47, -30, 62, 38, 73, -25, 44, -21, -3, -57, 67, 41, 7, 64, 57, -46, -24, -59, -72, -48, 43, -1, -56, -70, 47, -37, -35, 38, -1, -43, 42, -65, 47, -48, 44, -66, -17, -65, 37, -50, -48, 72, 29, 16, 63, 48, -70, 44, 26, 3, 64, -70, -60, 67, 54, 30, 58, -62, -1, -62, 9, -9, 45, -19, 39, 24, -54, -20, 1, 15, -43, -1, 42, 26, -38, 8, -54, -55, -70, 9, 52, 23, 33, -73, -17, 19, 40, 11, -45, 47, -13, 1, -33, -71, -24, 21, -38, -12, 65, 17, 15, 11, -66, 6, 22, -40, -73, -57, -39, 43, -39, 21, -32, 10, -42, -61, -7, -71, 8, -11, -55, -47, -37, 5, 37, 58, -52, 40, -30, -52, -8, -23, 32, -21, 50, -41, -63, 44, 51, -22, -55, -47, 74, -53, -38, -3, -18, 9, 37, -40, 38, -1, -61, 59, 42, 54, 72, -33, -39, 19, 13, -51, -20, 59, 12, 71, -71, 22, -12, -62, -10, 27, 12, -43, -53, -53, -59, 20, -73, 19, -15, -53, -40, -15, -66, -68, 12, -31, 9, -11, 15, 28, 71, 22, 21, 30, -35, -60, -40, 73, -45, 22, -51, 13, -40, -8, 68, -63, -33, -30, -54, -15, 2, 41, 40, 62, -6, 4, -15, 5, -67, 59, -55, 33, -62, 53, -9, 26, -5, -71, -72, 10, 6, 5, -31, 4, 19, 70, 64, -8, -23, 41, 60, 60, -6, 63, -17, -12, 33, -52, 23, 45, 22, 68, -50, 17, -18, 8, -1, 67, 14, -7, 28, 14, -9, -66, 21, -20, -14, -34, 33, 69, 59, -54, 57, -4, 28, 52, 14, -61, -59, 23, 70, 6, -20, -54, -21, 42, 68, 56, 11, -3, -34, 31, -17, -55, -45, -71, 9, 45, -26, 44, 42, 47, -57, 23, 17, 24, 58, -20, 37, -12, -47, -21, 13, -52, -24, 31, -54, 46, 16, -19, -63, -9, 33, -44, -71, -14, -53, 27, -12, 2, 0, -45, -50, -45, 55, 46, 44, -29, 43, 24, -45, -11, -19, -42, -21, 16, 32, -12, -46, 12, 69, 50, -42, 16, -1, 74, 7, -31, -63, -60, 42, -57, 2, -19, 65, 65, 17, -57, -22, -15, 34, 24, -3, -25, -6, -33, 48, 30, 16, 43, 9, 48, 71, 0, 27, -59, 52, 16, -70, 71, -58, 54, -24, -8, -12, 15, 39, -60, -46, 3, -35, 19, 63, 34, 58, -16, -16, -5, 26, -46, 26, 64, -50, -52, -27, 21, 15, -29, 72, -46, 21, 64, -34, -8, -14, -50, 10, 73, -50, 51, -24, -4, 2, 31, 53, -11, 20, -67, 16, 5, -15, 72, 15, -50, 14, -59, 34, -69, 42, -34, -42, 69, 41, 44, 25, -26, 32, 26, 32, 57, -15, 55, -26, 55, 10, 22, -19, -50, -44, 9, 59, 49, -39, 65, -9, -46, -7, 54, -6, 45, -4, -68, 73, 17, 12, 33, -24, 27, -51, 53, 16, -51, -29, 62, -11, -40, 27, -65, 4, -58, 8, 27, 67, -62, -70, -56, -74, -33, 72, -65, 67, 59, -27, -10, 42, -30, 42, 61, 43, 55, -36, -50, -51, -15, 38, 53, -14, 12, 43, 30, -14, 34, 35, -15, 2, -44, 45, 41, -17, 26, 72, 53, 39, 29, 68, -8, -70, 18, -37, -18, -27, -70, 37, 25, 1, -51, 18, 35, 0, 3, 52, -15, -26, 16, -13, 41, 27, 54, 31, -6, 69, -58, -11, -4, -40, 29, 15, 15, 38, -10, 50, -69, -7, -9, -24, -41, 45, 64, -31, 18, -3, -47, -2, 63, 17, -30, 62, -60, -33, 66, 62, 61, -72, 25, 65, -8, -73, -62, 3, 27, -20, -4, -38, 31, -1, -63, -70, -50, -17, -43, -2, 47, 41, -49, 24, -1, 17, -10, -51, 38, 7, -8, 35, 58, -59, 70, -46, 53, -34, 41, 17, -6, -62, 59, -68, 57, 47, 58, 37, -44, -8, 34, 21, 16, -35, 72, 49, -65, 16, 23, -4, -30, -13, -19, 9, 5, 49, -41, 69, -45, -5, -41, 55, -21, -46, 24, -70, 30, 37, -52, -64, 2, 51, 38, 41, 3, 11, -26, -47, -9, -23, -29, -63, 44, -55, 34, 68, 72, -58, 61, 39, 34, 14, 34, -50, 3, 59, -49, -14, 26, -4, 62, -62, 30, -71, -44, -64, -72, 5, 69, 7, 58, 37, -65, -42, 63, -50, -43, 54, -56, -6, 34, -32, -23, 68, 30, 1, 24, 41, 6, 27, -62, -36, -31, -48, -67, 12, 65, -23, -68, 35, -37, -47, -62, -21, 19, -34, 55, -23, 9, 14, 1, -32, 62, 53, 37, -63, -34, -45, 70, 60, -68, -42, 33, 66, -59, -65, -64, 67, -61, -68, -48, 42, -27, -72, -37, 52, 10, -13, 11, -19, 63, -17, -54, 40, 46, 32, -9, -10, 53, -50, 61, -57, 53, -10, -39, 21, -1, 50, -11, -14, -3, 59, -8, 59, 21, -56, 53, 27, 16, 32, 5, 22, -13, 11, -31, 42, 54, 64, -15, -67, -8, 13, -16, -38, -33, -72, -71, -41, 7, 19, -16, 64, -31, -2, 6, -13, 43, -39, 26, 69, 67, -49, 31, -44, -17, -46, 8, 33, 64, -10, 21, -14, -62, -57, 38, 46, -65, 45, 31, 58, 15, 64, -46, 67, -20, -48, -61, -71, 37, 5, 27, 11, -64, -70, 0, -22, 65, -1, 37, 7, 17, 23, 69, 15, 13, -48, -66, 69, 30, 67, 14, -7, 68, 8, 61, -31, -61, 11, 41, -49, -4, 66, -23, -54, 24, 68, -17, -18, -19, 66, 57, -4, 9, 63, 14, -44, -62, -65, -5, 3, -59, -8, -17, 22, 57, 52, 38, 1, -18, 25, -63, 48, -3, -14, 62, 25, -25, -50, 0, -16, -53, 21, -6, 70, 26, 19, 64, -6, 9, 36, -30, 62, -39, -62, -24, 72, -44, -15, 66, -29, 18, -32, -25, -27, -22, 48, -39, 34, 27, -19, 0, 4, 39, -14, -72, -20, 67, 31, 47, -14, 55, -47, -20, -15, -61, 68, -54, 10, 30, 5, 73, 34, 17, -71, 52, 69, -36, 23, -10, -22, 36, 55, 0, -58, -10, -66, -22, -67, 58, -41, 46, -54, -71, -37, 1, -35, 5, -7, -17, -44, 8, -43, -11, -72, 63, -21, 64, 31, -68, 70, 49, -45, 74, -45, -70, -58, -15, -30, 6, -48, -32, -73, -16, -70, 8, -37, 61, -35, -52, 71, -33, -19, -10, -27, -51, 73, 16, 58, 11, 51, -3, -51, 64, -60, -56, -69, 7, -60, 28, 20, 0, 43, 43, -29, -56, -29, 72, 65, 26, -6, -15, -27, -52, -12, -26, -52, -58, -53, -59, -68, 53, 55, -62, -45, 41, -45, 33, 27, -54, -13, -22, -39, 9, 62, 34, -67, -14, -52, -68, -16, 33, 73, 38, 52, 52, -32, -65, -69, -45, -33, 60, -58, 63, 70, -17, -9, -22, -1, -61, 69, 61, 2, -56, -71, -50, -22, -44, -67, 30, 31, -49, -1, -29, 74, -65, 16, -26, -6, 29, -10, -5, -30, -13, 13, -11, 46, 35, 22, 10, 16, -63, 64, -42, -43, 50, 72, -26, 22, 4, -49, 43, -58, 28, -40, 73, -7, 16, 54, 72, -29, -14, 39, -74, 19, 17, 0, -61, -11, 50, 14, 62, 2, -43, -72, -32, -49, -64, -29, -40, -8, 35, -44, -62, 17, -9, -2, -5, 23, 54, -22, 64, 41, 52, 31, 16, -15, 6, -38, -51, 50, 23, -69, 3, 33, -13, 14, -4, 73, 20, -31, 32, 27, -2, -25, -41, -14, -23, 64, -38, -68, -13, 23, -66, -39, 29, 15, -64, -15, -34, -39, 34, -54, -48, 21, 60, -63, 46, -6, 63, 57, 33, -60, 45, -71, 17, 3, 42, -42, 9, 51, 2, 20, -64, -50, -23, -17, -55, -45, -35, 14, 21, -30, -20, -35, -6, 41, 17, 13, -39, -66, 50, 11, 43, -44, 37, 68, -47, -42, -26, 74, -6, -33, 39, -59, -22, -24, -49, -38, 41, -53, -25, -10, -24, -1, 35, -14, 51, -65, -55, 71, 59, 41, -68, -51, -15, -23, 29, -31, -16, -26, 4, -22, -39, 3, 48, 27, -52, 71, 39, -20, -10, 57, -2, 40, -53, -19, -17, 44, 19, 68, 35, -67, 53, 62, 68, 41, -17, 52, 47, 16, -69, 19, 9, -40, -46, 12, 68, 9, -61, 34, 8, -57, -8, -70, -34, -54, 52, 14, -26, -58, -56, 51, -39, 4, 55, 47, 38, 34, -36, 69, 4, 72, -9, 3, -54, 58, 15, -7, 35, 48, -42, -49, 3, 64, -42, 23, 71, 18, 72, -50, 60, -29, -24, -20, 33, -53, 45, 10, -43, 66, 39, 4, -51, -53, -41, 28, -3, -51, 2, -23, -19, 42, -62, -20, 13, -6, 60, -15, 54, -52, 2, 42, 25, -69, 12, 11, 37, 17, -22, -57, -25, 31, -4, -37, -70, 43, -31, -30, 18, 5, -30, 42, 33, -31, 2, 62, 29, 65, 48, 4, -33, -50, -65, 63, -72, -18, 20, 3, -36, 46, 47, -6, 65, 32, -25, 10, -61, -22, 48, -5, 28, -66, -46, -4, 16, -57, -48, -26, 3, -32, 12, 68, -58, -48, 53, 31, -35, -4, 54, 31, -32, 58, 40, -20, 25, -39, 40, 61, -46, 35, -15, 74, -7, -3, 73, 50, -17, -45, 16, 13, -45, 65, -20, -69, 60, 69, -44, -20, -22, 68, 6, 7, -66, -48, -66, 11, 29, 38, 62, -63}

#define CONV2D_KERNEL_0_SHIFT (9)

#define CONV2D_BIAS_0 {86, 59, -106, 29, 76, 102, 56, 72, -50, -11, 101, 50, 83, 20, -91, 62}

#define CONV2D_BIAS_0_SHIFT (8)


/* output enconding for each layer */
#define INPUT_1_OUTPUT_SHIFT 7
#define CONV2D_OUTPUT_SHIFT 5

/* bias shift and output shift for each layer */
#define CONV2D_OUTPUT_RSHIFT (INPUT_1_OUTPUT_SHIFT+CONV2D_KERNEL_0_SHIFT-CONV2D_OUTPUT_SHIFT)
#define CONV2D_BIAS_LSHIFT   (INPUT_1_OUTPUT_SHIFT+CONV2D_KERNEL_0_SHIFT-CONV2D_BIAS_0_SHIFT)
#if CONV2D_OUTPUT_RSHIFT < 0
#error CONV2D_OUTPUT_RSHIFT must be bigger than 0
#endif
#if CONV2D_BIAS_LSHIFT < 0
#error CONV2D_BIAS_LSHIFT must be bigger than 0
#endif

/* weights for each layer */
static const int8_t conv2d_weights[] = CONV2D_KERNEL_0;
static const nnom_weight_t conv2d_w = { (const void*)conv2d_weights, CONV2D_OUTPUT_RSHIFT};
static const int8_t conv2d_bias[] = CONV2D_BIAS_0;
static const nnom_bias_t conv2d_b = { (const void*)conv2d_bias, CONV2D_BIAS_LSHIFT};

/* nnom model */
static int8_t nnom_input_data[16384];
static int8_t nnom_output_data[16384];
static nnom_model_t* nnom_model_create(void)
{
	static nnom_model_t model;
	nnom_layer_t* layer[3];

	new_model(&model);

	layer[0] = Input(shape(32, 32, 16), nnom_input_data);
	layer[1] = model.hook(Conv2D(16, kernel(3, 3), stride(1, 1), dilation(1, 1), PADDING_SAME, &conv2d_w, &conv2d_b), layer[0]);
	layer[2] = model.hook(Output(shape(32, 32, 16), nnom_output_data), layer[1]);
	model_compile(&model, layer[0], layer[2]);
	return &model;
}
