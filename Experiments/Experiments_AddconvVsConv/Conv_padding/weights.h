#include "nnom.h"

#define CONV2D_KERNEL_0 {4, -28, 45, -21, 60, 10, -24, -32, -35, 2, -30, 5, 4, -7, 53, -16, -14, -38, 31, 67, 40, 23, 70, 5, -53, -52, 28, -45, 3, -46, 49, 32, -46, 10, -50, 9, -9, 73, -22, 15, -63, 50, -43, 37, 59, 50, -4, -21, 70, -42, -3, 16, -23, -4, -67, -58, 55, -56, -64, 42, 71, -71, 7, -6, 31, 8, -37, 27, 60, 26, 11, -31, -62, 10, -14, -30, -61, 32, -19, -25, -27, -48, 48, 44, -3, 59, -43, 55, 52, -69, 24, -52, -46, 41, -1, 11, 31, 55, -62, -51, 31, -11, 5, 56, -26, 2, 5, -32, 72, -34, -8, -7, -69, 56, -27, 2, 47, 62, 20, 5, 57, 29, 71, -39, 61, 7, 3, 38, 71, 52, -7, 58, 35, -22, 43, 12, -65, -29, 29, -33, 60, -42, 52, 0, 24, 56, -14, 73, 4, 38, -40, -63, -56, 29, 41, -59, 55, 54, -20, -16, -18, -8, 12, 32, 43, -42, -65, -37, 28, 53, -30, -51, 64, 28, 59, -47, -11, 69, 18, 9, -34, 72, 24, -49, -43, 39, -27, -13, -2, 35, 9, 64, -7, -37, -34, 58, -41, -68, 73, -14, -63, 65, 37, 20, 46, 28, 18, 44, 37, 5, 27, -33, 15, 35, -72, -26, 32, -2, -50, -64, -59, 43, -17, -20, 63, 25, 70, 68, 64, -58, -21, 19, -61, -74, -13, -32, 57, 36, 27, -25, 16, -56, -2, -13, 15, -31, 55, -35, -53, 22, -1, -53, 54, 53, -44, 9, 15, 51, 48, -10, 53, 13, -62, -12, -24, 20, -27, -28, -42, -68, -63, 15, -3, -44, 57, -42, 73, 27, -8, 57, -31, 26, -68, 44, -8, 33, -66, 47, -52, -3, 37, -22, 63, -6, 26, -59, 63, -53, -10, -13, 14, -61, 39, 13, 26, 47, -5, -3, 55, -57, 11, 61, -21, 70, -32, 12, 45, 39, -11, 5, -17, -74, -71, 9, -54, -5, 15, -70, 5, -20, -68, -46, 65, 2, 0, -47, 68, -4, -62, 4, -19, 11, -25, -53, 32, 14, -61, 33, 15, 55, -16, -45, -1, -62, -17, 45, 51, 47, 29, -64, -68, -39, -5, -20, -10, -32, 57, 71, 17, 28, -13, 35, -30, -65, -63, -50, -41, 65, 23, -37, 18, 42, 26, -42, -30, -22, -36, -72, 58, 28, 2, -47, -68, 20, 41, 30, 16, 6, -53, -10, -12, -48, 41, -21, 40, -54, 9, -1, 59, -15, -47, -16, 41, 37, 10, -18, 48, 69, -14, -37, -40, 37, -37, 40, -44, -37, 24, -14, 7, -27, 31, -11, -22, 72, 49, -5, -26, -21, 43, -6, 35, -61, -70, 26, -57, 30, -31, 2, -73, -25, 19, -13, -25, -17, -60, -24, 19, -21, 58, -18, 25, 24, 28, -34, -71, -30, -44, -48, -53, 4, 47, -1, -30, 18, -64, -17, 30, -36, 59, -9, -60, 67, 9, 14, -57, -67, 48, -28, -12, -9, -19, 13, -6, -47, -63, 9, -17, 23, -35, -51, -19, 49, 11, -18, 30, 25, 37, -35, -60, 69, -53, -69, -61, 0, 20, 48, -61, -3, -45, -13, -65, 12, 58, 12, 59, -22, 55, 39, -21, 71, -42, -28, -65, -48, -58, 25, -38, -45, 27, -40, -54, -18, -28, -7, 49, -40, -41, 41, -42, 56, -26, 23, 8, 71, 38, 32, -52, -20, 0, 70, 39, 53, 38, 41, -37, 51, -36, 5, 35, -37, -47, 50, 66, 71, 39, 71, 22, -46, -34, 59, 38, -72, 25, 65, -10, 22, 63, 43, 46, 66, -45, -13, 23, -64, -35, -51, -6, -33, -38, -72, -37, -8, 12, -16, 16, 2, 40, -45, -51, -61, -47, -48, -14, 39, 51, 31, -65, 25, 13, 23, 34, 23, -7, -58, -21, 26, -42, 65, -30, -56, 9, 10, -52, 28, -1, 30, 9, -66, -6, 35, -33, -36, -55, -4, 51, 44, 35, 59, -19, -52, -18, 16, 29, 69, -59, 19, 2, 60, 13, -2, -63, 70, 52, -55, 17, -66, 72, 56, -9, -17, 21, 16, 72, 37, -47, 25, -40, -27, -22, -61, -15, -23, 40, 44, -26, -38, -23, -27, 14, 10, 44, -2, 16, 44, -8, 44, 48, -44, -9, -68, 50, -49, -50, 71, 28, -69, 60, -66, 13, -46, 21, 13, -67, -27, -40, 67, 20, 23, 38, -68, -32, -39, -57, 22, -56, 45, 13, 3, -5, -11, -39, 40, -52, -69, -14, -26, -72, -51, -1, -5, 52, 35, -15, -67, 11, -26, -22, -1, 51, 69, 35, 9, 67, 61, 15, -35, -30, -51, 51, -31, 64, 6, 32, -44, -34, 34, -25, 48, 30, -60, 12, 68, 34, 54, 22, 66, -40, 27, -35, 48, 73, 23, -14, 65, -61, -39, -26, 35, -24, -69, 38, 9, 35, -70, -27, 39, 9, 37, 13, -1, 38, 40, -56, -41, -49, -63, -73, 74, -39, 14, -31, 20, -38, -74, -63, -67, -2, 8, -33, 27, -63, -73, -2, 11, 36, 30, -10, -19, 31, 41, 3, -59, 69, -51, -55, 50, 52, 45, -49, -46, 17, 64, -16, -65, -10, 1, -46, -13, -25, -65, -9, 41, -36, 39, 23, -37, -39, 65, -61, -58, 8, 57, 61, 21, 22, -50, 52, 48, 58, 33, 4, -13, -40, 21, 41, 53, -57, -40, -61, 60, -37, 33, -64, -26, 47, -31, -6, -68, 46, -45, -24, 43, 29, 56, 73, -1, 0, -20, -33, 18, 73, -54, -33, 62, -62, 17, -61, -49, -64, 6, 56, -40, 58, -22, 7, -66, 73, 10, 31, 33, -59, -29, -3, 35, -11, 65, 19, 3, 61, 16, -4, 19, 64, 25, -69, 60, -40, 42, 23, 24, 11, -33, 60, 64, 69, -43, -58, 72, 63, -41, 66, -8, -20, -40, -47, -17, 35, 24, 20, 61, -10, -5, -32, 69, 70, -62, 64, 0, 72, -65, -8, 0, -26, 49, -39, -13, -54, 47, -13, -70, -39, -55, -33, -33, -12, 40, 48, 52, -44, 16, -50, -24, 56, -49, -12, 5, 17, -65, 69, -35, -57, 10, 37, -3, -1, 52, -46, 18, 5, 26, -9, 54, -50, 38, 0, 56, 57, -21, -2, -68, -17, 68, -23, -14, 11, 27, -71, 48, -19, 64, -50, -40, -48, -47, 37, -66, -34, 67, 68, -14, 47, 63, -15, 40, -23, -63, 26, 3, 60, 12, -58, -36, -48, 36, 45, -4, -6, -67, 40, 1, 71, 0, -33, -53, -43, 19, 46, -73, -55, 73, -26, -3, -17, -46, -27, -31, 27, -35, -4, -41, 68, 19, 39, 2, 39, 26, -62, 50, -4, 70, -27, -38, -54, 20, -11, 15, -56, -38, -37, -73, 69, 3, -21, -73, 16, -40, -47, -6, -57, 73, -31, 0, -45, 20, -58, 29, -5, -5, -65, -38, -61, 46, -54, 51, 28, 63, 55, -27, 17, 3, 57, -1, 65, -31, 38, 24, -57, 56, -39, -65, 14, 21, -52, 63, -33, -33, -44, -58, 53, 54, -2, -63, -22, 1, -30, -28, -67, 36, 2, -47, 27, -63, -31, 37, 54, -36, -2, 74, -64, 22, -26, 1, 63, -35, 62, -36, -4, -27, 9, 45, 2, 22, -6, 46, 45, 64, -61, 0, 66, -5, -13, -62, 54, -21, 18, -49, 22, -65, -42, -71, 22, 4, -8, -64, 49, -29, -32, 43, 34, 23, 49, 10, -5, -63, 5, 40, -25, 17, -4, -74, -64, -8, 52, -27, 25, 53, -59, 73, -71, 15, 64, 23, 71, -49, 44, -60, 44, 18, -25, -31, 8, 7, 17, 7, -25, 27, -46, -38, 65, 57, -21, 31, -41, -47, 35, -37, -72, -34, 60, 39, -36, -51, 52, -9, 66, -2, 41, 28, 58, -38, 10, -39, 26, -72, 17, 4, -25, -62, 33, 7, 41, -17, -9, -31, -34, 59, -56, 35, -35, 17, 71, 28, -6, -9, 54, 47, 57, -8, 15, -35, -3, 65, 14, 40, -57, -54, -47, -45, 55, -40, -56, 28, -55, 43, -35, -9, 71, 40, -54, 70, -11, -26, -19, -33, 24, -46, -53, 32, -73, -54, -69, -67, 72, -38, -45, -9, -53, 70, -2, 30, -30, 0, -6, 17, -21, -17, 44, 71, -58, -57, 52, 13, 30, -35, 5, -4, 70, 49, -39, 42, 25, -27, -70, 51, 25, 11, 21, 38, -67, -13, 59, 9, 9, -25, 22, 0, -1, 31, -45, 29, -16, 54, 52, 58, 48, 43, -30, -73, -14, -20, 25, 19, -42, 49, 52, 22, -71, -43, 62, -21, -24, -42, 33, 35, -51, 42, 19, 60, 68, 31, -66, 68, -37, 33, 61, -68, -59, -30, -19, -7, 49, -69, 23, 31, -15, 3, 51, 35, -63, 73, -5, -36, -15, 21, 48, 2, -53, 53, 32, 30, -47, 29, -29, 39, 13, 30, -13, -36, -69, -2, 43, -29, -34, -32, -10, -36, 7, -45, 29, 43, -4, 43, 6, -27, -37, -51, 50, 11, -58, -21, 44, -16, 47, -51, -44, -28, 11, -74, -22, 57, 50, -70, 13, 44, 0, 24, 56, -65, -10, -36, 49, 73, 8, -65, -57, -7, 50, -1, -27, 57, -36, 44, -16, -21, -55, -70, 51, 62, -53, 71, 71, 13, 59, 31, 25, 54, -45, 48, 14, 34, -41, 47, 48, -55, -43, -29, -8, 22, 62, 63, 72, -27, -19, -25, 48, 17, -51, -69, -39, 33, -60, 22, 27, -53, -33, -47, 64, 23, 19, 20, -1, -59, -1, 24, -19, -13, 3, -33, 31, 47, 4, 64, 23, 53, -16, 55, -44, -39, -41, 23, -22, -71, 19, -35, -31, 4, 54, -28, -32, -54, -50, 72, 16, -60, 52, 5, -10, -42, -71, -33, -40, 46, -7, 60, 12, 38, -36, -20, -3, 5, 41, 38, -9, 60, 7, -30, 37, 5, 14, -9, -57, -56, -9, 13, 19, 39, 30, 70, -69, -69, -41, 50, 68, 62, -68, -73, -12, -71, -38, 26, 35, 15, -25, -24, 40, 36, 58, 7, -7, 39, -13, 46, -13, -71, -32, 59, -4, 49, -4, -61, -6, -58, 29, 44, 51, 23, -24, -32, 33, -20, -64, 33, 52, 68, -37, -35, -73, -50, -21, 74, 35, -2, -36, 58, 68, 57, 24, 37, -58, -12, 60, 38, -25, 73, 31, -48, 20, -72, 35, -43, -8, 56, 41, -18, -52, 14, -20, -53, 23, 64, 2, -3, 15, 55, -57, 14, -19, 5, 39, -28, 23, 37, 46, 20, -10, -64, 17, 57, 28, -26, -7, 44, 8, 26, -3, -24, -21, -51, 25, 7, 37, -8, 42, -58, 54, -59, -67, 65, 65, 56, -16, -52, -33, -21, -45, 46, -34, -40, 55, 23, 33, -70, -72, -47, 24, 56, 24, -13, 31, 27, -4, -5, -71, -40, -26, -60, 5, -39, -7, -63, -13, 59, -9, -19, 19, -21, -30, 37, 30, -51, 9, -34, 69, 2, 21, -68, 45, 26, -74, 50, 53, -37, -44, 72, 65, -71, -3, -49, -21, 33, 48, -53, 59, -28, 70, -13, 38, 6, -49, 1, -47, -20, 25, 46, 37, -18, 3, -30, 42, -12, -31, 65, -8, -52, 19, 45, 25, 54, -65, 13, -46, 71, -47, -43, 5, -36, -8, -8, 29, -46, -63, 37, 17, 13, 45, -4, -8, -19, 13, -34, -20, -31, 67, -51, 26, 70, -45, 53, 41, 66, -4, 60, -42, -34, 18, 54, 47, 69, 63, -35, 10, 66, -23, 49, -25, 51, 0, 56, -62, 19, 47, -33, -33, 23, -18, -1, -48, 66, -24, -29, -71, 14, -23, 67, -32, -21, 63, 2, 37, -46, -37, 5, 39, -55, 62, 40, -13, -49, 38, 59, 55, 24, -69, 59, 53, 63, -39, 59, 38, 16, -57, 42, -4, -38, -70, 43, -18, 22, 58, -11, 23, 67, -66, -56, 0, -44, 28, -8, -69, -49, 0, -46, 16, -8, 18, -5, 57, 8, -30, 4, 59, 42, -68, -17, -61, 33, 46, -45, 67, 60, -54, -66, 65, -14, -33, 27, 37, -41, 35, -10, 3, -52, -51, -39, 2, 63, -72, 25, 66, -4, 51, 27, 5, 68, 51, -72, 39, 32, -18, -60, -32, 2, -37, -26, -74, 59, 45, 67, 51, -58, 61, -74, -24, -22, -9, -42, 38, -27, -56, 38, 2, -39, -30, 34, 47, 57, -21, 29, -52, 57, 50, -17, 28, 63, -16, 55, 3, -30, 62, 72, -68, 21, -8, 37, -4, -19, 16, 51, 37, -34, -59, 60, 43, -23, -52, -4, -40, 69, -69, 47, 3, -61, -1, -18, -21, -52, 6, 27, -18, -48, 63, 64, -55, -61, 72, -44, -22, 54, 32, -27, 35, -54, -51, -70, 66, -5, -43, 37, 69, -17, 29, -32, 53, -48, 9, 53, -18, -5, 67, -26, -71, 16, -69, -7, 51, -64, -33, 6, 34, -62, 60, -56, 42, 57, 50, -34, 32, -70, 64, 40, 34, -23, 5, 26, 2, 6, 51, -41, 51, 42, 71, -3, -63, 30, 62, -51, -53, -69, -60, 36, 2, 35, -30, 5, -43, 68, -36, -20, -21, 56, 25, 72, 3, 49, -67, -32, -13, -33, 31, -57, -54, -62, -37, 39, -47, -58, 46, 45, -29, -29, 10, 65, -40, -53, 72, 23, 65, 7, 70, -66, -15, -12, 12, 34, 53, -69, 23, 3, -11, -23, -17, 66, 39, -12, -51, 73, -17, -35, -53, -56, -13, 66, -20, -7, 69, -73, -28, -53, -3, 70, 18, 26, -71, -6, 18, -12, 43, 6, -16, -21, 54, 46, -36, 20, -24, -26, 22, 44, 70, -29, 26, 32, 4, 50, -41, -24, -64, 8, -70, -38, 25, -63, 70, -1, -5, 22, -34, 20, 32, -66, 4, -65, 15, 35, -53, -39, 67, -61, 41, 15, -24, 65, 62, 66, -24, -15, -44, -50, 32, -63, 0, -8, 26, -20, -55, -18, 21, -49, -60, 31, 24, 34, 40, 35, 54, -19, 59, -66, -24, -16, -3, 45, -65, -19, 70, -61, -4, -33, -31, -44, -50, -71, -59, 71, 21, 29, -20, -25, 35, 12, 20, -31, -53, -35}

#define CONV2D_KERNEL_0_SHIFT (9)

#define CONV2D_BIAS_0 {60, -38, 78, -13, -33, 20, -106, 107, 13, -107, 23, -109, -61, 20, -73, -35}

#define CONV2D_BIAS_0_SHIFT (8)


/* output enconding for each layer */
#define INPUT_1_OUTPUT_SHIFT 7
#define CONV2D_OUTPUT_SHIFT 6

/* bias shift and output shift for each layer */
#define CONV2D_OUTPUT_RSHIFT (INPUT_1_OUTPUT_SHIFT+CONV2D_KERNEL_0_SHIFT-CONV2D_OUTPUT_SHIFT)
#define CONV2D_BIAS_LSHIFT   (INPUT_1_OUTPUT_SHIFT+CONV2D_KERNEL_0_SHIFT-CONV2D_BIAS_0_SHIFT)
#if CONV2D_OUTPUT_RSHIFT < 0
#error CONV2D_OUTPUT_RSHIFT must be bigger than 0
#endif
#if CONV2D_BIAS_LSHIFT < 0
#error CONV2D_BIAS_LSHIFT must be bigger than 0
#endif

/* weights for each layer */
static const int8_t conv2d_weights[] = CONV2D_KERNEL_0;
static const nnom_weight_t conv2d_w = { (const void*)conv2d_weights, CONV2D_OUTPUT_RSHIFT};
static const int8_t conv2d_bias[] = CONV2D_BIAS_0;
static const nnom_bias_t conv2d_b = { (const void*)conv2d_bias, CONV2D_BIAS_LSHIFT};

/* nnom model */
static int8_t nnom_input_data[4096];
static int8_t nnom_output_data[4096];
static nnom_model_t* nnom_model_create(void)
{
	static nnom_model_t model;
	nnom_layer_t* layer[3];

	new_model(&model);

	layer[0] = Input(shape(16, 16, 16), nnom_input_data);
	layer[1] = model.hook(Conv2D(16, kernel(3, 3), stride(1, 1), dilation(1, 1), PADDING_SAME, &conv2d_w, &conv2d_b), layer[0]);
	layer[2] = model.hook(Output(shape(16, 16, 16), nnom_output_data), layer[1]);
	model_compile(&model, layer[0], layer[2]);
	return &model;
}
