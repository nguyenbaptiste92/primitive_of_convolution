#include "nnom.h"

#define GROUP_CONV2D_KERNEL_0 {-25, -7, 30, 2, 62, -32, -56, -64, 31, 64, 71, -54, 67, 15, 24, 72, -45, -36, 22, 65, 47, 57, -33, 30, -15, 55, 7, -12, 68, 4, -16, -22, -31, 41, 6, 11, -35, 74, -21, -13, -52, -3, 41, 37, 32, -21, 69, -3, -16, -15, -59, -35, 4, 23, -68, 22, 68, 45, -62, -35, 30, -66, -11, 34, -56, 66, 40, 61, 45, -28, 64, -41, -13, 37, -60, 12, -67, -50, -69, 1, -53, -9, 36, -6, 21, -56, -68, -1, -42, -62, -9, -64, 19, -45, 36, 33, -41, 66, 38, -66, 45, 72, 34, 28, 51, 67, -26, -61, 21, -29, -17, -23, -21, 14, -64, -41, -32, -49, 30, 23, 71, -58, -5, 55, -56, 65, -26, -13, 40, -7, -60, -6, -60, -20, -62, 37, 64, 30, -35, -4, -72, -52, -50, 19, -24, -53, -28, -67, 61, 13, -27, -30, 51, 31, 34, -69, 6, 37, 43, 50, 29, 0, 6, 38, -29, -17, -5, -50, 25, 49, -52, 54, -32, -15, 28, -60, -19, 46, 65, -69, 28, 54, 62, -69, -14, 58, 68, 23, 0, -12, 19, -66, -50, -52, -42, 58, 70, -24, 29, 3, -33, -66, -64, -62, 4, -48, -59, 35, -54, 4, 26, -71, -9, 57, -5, -72, -24, 54, 41, 64, 64, 9, 3, -51, 48, -11, 16, 3, 57, 65, 17, 64, 38, -47, -37, -66, 51, -56, -23, -32, -3, -22, -38, 20, 42, 31, 52, 41, -31, -54, 61, 13, 24, 22, -41, 72, -35, 66, 49, -36, 58, 65, -8, -71, -17, -64, 1, 32, -4, 73, -4, 48, -28, 73, -38, 70, -39, 50, -47, -49, 8, -54, 31, -9, 64, 42, -19, -65, -44, 72, 24, -40, 17, 21, -41, 66, -26, 64, -31, -2, -50, -29, 36, -27, -6, 45, -10, 50, 64, 33, 38, 2, -47, -22, -49, 62, -56, 37, 37, 66, 55, -2, -32, 68, -8, 35, -2, -33, -50, -43, -42, 47, 29, -23, 38, -59, -49, 53, 31, -33, 44, 36, 46, 68, 12, 24, 6, 59, 27, -21, -42, -42, 22, 36, 22, -11, -40, -63, -52, 13, -33, -47, -38, -3, -63, 68, 70, 20, 29, -49, 71, 40, 43, 59, 42, -34, 38, -45, 66, -2, 21, 28, 29, 45, -33, -12, 63, 15, -48, -45, -43, -57, 52, -45, 32, -45, 38, 38, 17, 43, -67, 10, -50, 38, 69, 48, 39, 27, 15, 60, -65, 57, -62, 25, 23, -71, -6, -70, 57, -58, 51, 42, -64, -7, -9, 44, -10, -67, -46, -54, -29, 45, -66, 22, 65, 37, 26, 40, -68, 73, -14, -13, 41, 10, -41, -46, -18, -23, 35, 15, -26, 39, 12, 52, 65, -58, -48, -25, -21, -35, -24, 72, -60, 4, -55, 69, -28, -42, -66, 46, -13, 23, -58, 8, 28, -54, 72, -46, 24, -66, -42, -35, 71, -53, -6, 46, 4, 68, 27, 60, -56, 50, -17, 48, 49, 14, -58, -28, 16, -21, -36, -2, -70, 9, -40, -52, -29, 32, -4, -31, -63, -59, 38, -65, -26, 21, -62, 18, -62, -3, -1, 48, -5, 45, 14, -19, 52, 61, 68, 60, -19, -50, 59, -21, -65, -35, -28, -65, 3, -59, -2, -30, -3, 72, -10, 63, 27, 60, 16, 28, -63, -22, -71, 14, 9, 25, -42, 54, -38, 6, -62, 27, 13, -53, 58, -59, -10, -58, -11, -58, -51, -67, 41, 23, -32, 60, 2, -5, 21, -4, 22, -34, -49, -29, -15, -66, -25, -16, 23, -57, -35, -20, -42, 21, 23, 64, 22, -73, -9, -43, 18, 0, 43, 47, 53, -14, -67, -57, -23, -61, -31, 60, 46, -18, -10, 64, -58, 19, -30, -3, 44, -7, 12, 11, 24, 72, 0, -4, 67, -51, -43, 21, -3, 56, -35, -61, -36, 72, -7, -55, -10, 16, -46, -24, 43, 11, -60, -33, 37, 36, 39, -46, -66, -37, 24, -17, 3, 47, 15, -39, 54, 11, 37, -18, 8, -35, -52, 27, 6, 7, 42, 71, -42, -51, 8, 39, 62, 45, 6, -32, 16, 69, 50, -35, 16, -14, 54, -19, 13, -47, -72, -44, 9, -66, 13, 8, -19, 61, 25, -8, 68, -26, 41, -26, -60, 23, 16, 12, 51, 73, 63, -38, 52, 31, 22, 69, 43, -7, -60, 21, 21, -51, -53, 5, 67, -8, -34, 15, 10, 58, -11, -53, -7, 14, 21, -48, 34, 40, -22, 27, -54, 41, 40, -44, 48, -36, 0, 38, 58, 15, 8, 20, -6, -52, 9, 27, -27, -9, -70, 53, -25, -44, 57, 57, 28, -28, 44, -9, 64, -28, 11, 16, 39, -17, 69, 3, 27, -74, 71, 22, 30, -32, -23, -66, 18, 11, 31, -27, -50, 28, 39, -39, 56, 61, -66, 35, -68, -56, 53, -73, -59, 55, 68, -65, 9, -39, -6, -42, 71, 2, 57, 57, -66, 57, -42, -22, 67, -73, -34, 26, -25, -42, 73, 39, -35, 22, -32, -20, -66, 37, -6, -61, -3, 56, 17, 46, 38, -59, -39, 54, 60, -25, 0, 18, -11, -17, 72, 57, -7, 24, -15, 56, -10, 7, -18, -7, -4, -33, -61, -49, 35, 46, 15, 53, 59, -52, -29, 47, 38, -3, 58, 55, 36, -61, -32, -58, 19, -48, -72, 7, 50, -2, 31, -61, 61, -7, -9, -73, -1, -11, -15, 39, -42, -35, -63, 9, -32, -24, -35, -48, 32, 4, -66, 43, -62, -55, -71, 60, -43, 6, 55, -49, -40, 39, -61, -21, 58, -57, 6, 13, 28, -12, -22, -71, 44, 56, -41, -10, 27, 5, -63, -45, 6, -2, -37, 18, -57, 6, -41, 47, 21, 21, 74, 8, -18, 68, -65, -46, -47, 34, -41, 31, 11, 40, 35, -47, 27, -11, -20, -37, -74, -34, -32, 9, 19, -35, 56, 23, -38, -33, 29, -53, -32, -43, 6, -57, 47, -68, 21, -36, 37, 7, -13, -12, 1, 18, -67, -50, 36, 63, -67, 69, 41, -58, 59, 22, 19, -44, 45, -71, 34, -15, -4, 9, -12, 65, -15, 6, 65, 64, 14, -12, -45, 42, 58, -57, -29, -35, 13, -67, -2, 39, 60, -35, -9, -61, 6, -31, 21, 5, 24, -21, -10, -32, 59, 37, -63, -15, 41, -53, 28, 20, 59, 56, 7, 39, -52, -74, -65, -69, -67, 57, 26, -63, -4, -60, 44, 27, -68, 54, -71, 73, -31, 21, -69, -5, 33, -68, 51, -11, 38, -37, -22, 24, 3, -15, -58, 8, 31, -44, -5, -32, 12, -37, -66, 32, -30, -58, 25, 10, 26, -13, 53, -7, 22, -36, -37, 21, -72, 34, 50, -73, 1, -27, 54, 66, -17, -56, 20, -64, -19, 19, -20, -4, 33, 38, -9, -12, 16, -32, -30, 56, 33, 40, -1, 59, 61, -3, 63, 72, -60, -36, -17, -32, -70, 53, -10, 44, 31, -45, -45, -69, 11, 60, -14, -18, 1, 31, -7, -22, 34, 19, -62, -13, -51, 8, -29, -44, 60, -61, -36, 28, 8, 14, 48, -57, 18, 23, -15, -13, 42, 24, -52, -26, -7, 73, -26, -33, -44, 33, 48, 12, 14, -61, -5, 19, -61, 3, 50, 61, -32, 11, 33, 14, 61, -74, 23, 70, 66, 57, -60, 21, -63, -12, 45, -23, 51, 49, -67, 61, -9, 71, 37, -29, -36, -16, 24, -42, 71, 25, 22, 57, -55, 37, -51, 18, 52, -38, -24, -19, -36, 29, 65, -10, -36, -55, -59, 37, -14, 72, 25, -11, 15, 42, 35, 0, -33, -56, 12, 60, 1, 12, 20, -44, 67, 11, 63, 27, 34, -28, -33, 61, -27, -71, -70, -67, 50, -17, 44, -24, -50, 21, -20, 10, 20, 31, -61, -42, -32, -70, -33, -7, 74, 24, -41, 49, 42, -9, 69, -33, 31, -56, -57, -10, -48, -52, -71, -24, 33, -49, -48, 20, 20, -16, -52, -43, 72, -29, -51, -18, 24, 70, 62, -54, -14, -70, 45, 48, -12, 68, 48, -45, 16, -51, -59, 18, -25, 57, -60, -5, -18, -71, -37, 20, -66, -34, 46, -24, 38, -46, -36, 44, -28, 13, -26, -15, 33, -35, -14, 18, 15, -17, 44, 12, -56, -52, 4, -61, 10, 25, -28, 48, 36, -42, 29, 44, 5, 21, -64, 41, 20, -18, -26, -4, -24, 56, -37, -26, 37, -45, -1, 11, 45, -54, 32, -1, 28, -12, 25, 34, 22, -63, 4, -25, -31, -20, -46, -44, 59, 28, -59, -65, 49, 36, 67, 71, 32, 67, -36, -50, -2, 35, 59, -65, 54, -69, -53, 7, 13, 19, 4, 5, 41, -15, 65, -26, -66, -61, 74, 60, 13, 24, -6, 59, 72, -7, 34, -68, 57, 56, -17, -35, 21, -40, 45, -72, -27, 27, 72, -64, -19, -73, -69, -72, 40, 21, -18, -67, 19, -61, 49, -61, 26, 3, 29, -40, 59, 12, -20, 7, 20, 19, -3, 57, 18, -60, 33, -7, -48, 9, -30, 73, -9, -57, 28, -66, 40, -65, -33, 59, -63, -37, 58, -29, 25, 11, -54, -67, 19, 19, -33, 10, -5, -44, -34, -13, -35, 65, -15, 28, 15, -32, -6, -58, 20, -52, -51, 44, 17, -43, 50, 62, -66, 64, 19, 8, 24, -70, 16, -14, 45, -56, -43, -63, -65, 67, -69, -47, 58, -8, 67, 63, 59, -70, 6, -37, -1, -1, -31, -53, -18, 30, -55, 70, -26, -53, -9, 9, -34, 38, -39, 17, -53, -67, -65, 4, 39, -10, 13, -48, -7, 12, 34, -61, -23, -69, 29, 50, 6, 34, -12, 66, -4, -22, 9, -19, 5, 13, -73, -35, -64, 29, -61, 21, -46, -15, 40, 70, 8, -18, -71, 35, 2, -24, 14, 17, 31, 32, 9, 37, 36, 36, -48, 30, 65, -52, -62, 74, 73, -70, -26, -13, 49, -47, 69, -73, 61, 25, -3, 19, -53, -17, 15, -72, -68, 57, -36, 58, -9, 4, 14, 21, 68, -71, 48, 15, 30, -15, -13, -20, 47, 42, -9, -1, 1, -32, -33, 60, 54, -38, -42, 62, -14, -44, 44, -46, -34, 45, 2, 23, 63, 12, -63, -8, 1, 64, -39, -42, -33, 16, -73, 68, -46, 43, 57, 11, -22, -54, -7, -12, -42, 64, 30, 45, 26, -41, 42, 22, 26, 53, 46, -11, 12, 34, 40, 72, 16, 36, -16, 21, 29, -49, -38, 25, -26, -10, 7, 67, 30, -58, 53, -63, -56, 31, 14, -53, -17, -25, 20, 29, 54, 36, -47, -10, 12, -21, 27, -54, 60, -41, -31, 16, -6, 41, -58, -7, -13, -35, 69, -21, -20, 22, -55, 47, -58, 5, 57, -32, -42, 53, 50, -61, -46, 21, 20, -28, 72, 20, 33, -11, -66, 8, 54, 22, -7, 48, 20, 5, 44, 24, -35, 4, 1, 25, -44, 62, 65, -28, 19, 1, 36, -22, 59, -52, -3, 11, -24, 59, -19, 70, -25, 48, -29, -13, 65, -58, -17, -26, 58, -48, 4, 16, 10, -54, -13, -27, 27, -25, 61, -40, -48, -13, 60, -51, 61, -18, 6, 37, -26, -33, -37, -45, 69, -55, -50, -22, -66, 28, -20, -46, 39, -17, 54, -5, 71, -1, -55, -20, -32, 51, -71, 25, 65, 11, -48, -44, -14, 20, 56, -34, -53, 38, -40, -46, -38, 30, -57, -46, -34, -68, 0, -70, -49, 37, -70, -2, -36, 7, -20, 23, 52, 48, 36, -26, 74, -23, 21, 11, 51, 28, 72, -72, 63, -5, 8, -42, -32, -35, 2, -67, -67, 14, -48, 53, 63, 65, 32, 15, -38, -17, 62, -8, -13, 4, 34, -13, -74, 56, 66, 69, 63, 2, 49, 67, -2, 42, 11, -54, -68, 40, -71, 63, -61, 47, 72, 47, 54, 4, 33, 9, -32, 18, 23, -55, -55, -17, -4, 42, 7, -50, -6, 15, -20, -51, -30, 71, -1, -66, -33, 32, 4, -29, 40, -41, 20, -30, -61, -74, -8, 53, -11, -53, -48, -34, 28, -22, -38, -49, 6, -14, 20, 58, 53, 25, 31, -49, 46, -46, -51, 9, -45, 69, -38, 45, -64, 72, -17, -17, 60, -3, -60, 68, 67, 66, -13, 52, 56, 36, 66, -18, -20, 16, -72, -36, 47, -65, 42, -52, -45, -23, -32, -16, 60, -6, -38, 72, 45, -65, 36, 61, -63, -67, 17, -32, 19, 42, 34, -62, 14, -13, -33, 20, 47, -3, 24, 31, 18, 67, -35, -25, 8, 24, -8, 57, -25, 68, 10, -46, -10, 63, -74, 1, 45, -59, 55, 64, 36, 37, -66, 65, 40, 20, 55, -1, -5, 55, 60, -39, 57, 58, 36, -63, -68, -43, 1, 64, 57, -9, 36, -70, 6, 53, 21, 66, 17, -62, -51, 58, 7, -61, 66, -24, -24, 59, -27, 33, 13, 37, 55, 15, 47, -70, 35, -52, -52, 32, -32, -53, -10, -33, -21, 19, -16, -45, -41, -62, 51, 56, -38, -39, -63, -9, 66, 33, -5, 62, 27, 25, -15, 31, -57, -24, 52, 20, 2, -70, -4, -26, 16, 71, 36, 32, 38, -25, -64, -20, 23, 19, -20, 0, -20, -53, -25, 1, -2, -36, 31, -54, -36, -72, -35, -69, -3, -58, 56, 41, 44, -62, 39, -21, -58, -70, -13, 1, 13, -3, 38, -69, -64, -12, 3, -16, -70, -74, 50, -4, -50, 2, -46, -60, -67, -44, 45, -14, 10, 37, 64, -39, 10, 43, -22, -54, 58, 66, 20, -4, -9, 69, 6, -31, 12, -55, -58, -24, 9, 35, -56, -42, 8, 49, 61, 47, 1, -46, 64, -41, -55, -29, -44, 72, -55, -56, -62, 51, 6, -37, -69, -56, -61, -15, 0, 33, -32, -68, -45, 23, 62, 48, -20, 9, 72, 24, 26, -66, -46, 27, 21, -7, 67, 13, 53, 55, 30, -19, 59, 54, 70, 58, -6, -71, 65, -39, 56, 22, 40, -9, -3, -27, -39, -35, -10, 13, 68, 68, -20, -18, -56, -56, -10, -35, -31, -47, 42, -41}

#define GROUP_CONV2D_KERNEL_0_SHIFT (9)

#define GROUP_CONV2D_BIAS_0 {24, 1, -8, 70, -97, -7, 108, -50, -1, -42, 100, -35, -105, -98, -86, -32}

#define GROUP_CONV2D_BIAS_0_SHIFT (8)


/* output enconding for each layer */
#define INPUT_1_OUTPUT_SHIFT 7
#define GROUP_CONV2D_OUTPUT_SHIFT 5

/* bias shift and output shift for each layer */
#define GROUP_CONV2D_OUTPUT_RSHIFT (INPUT_1_OUTPUT_SHIFT+GROUP_CONV2D_KERNEL_0_SHIFT-GROUP_CONV2D_OUTPUT_SHIFT)
#define GROUP_CONV2D_BIAS_LSHIFT   (INPUT_1_OUTPUT_SHIFT+GROUP_CONV2D_KERNEL_0_SHIFT-GROUP_CONV2D_BIAS_0_SHIFT)
#if GROUP_CONV2D_OUTPUT_RSHIFT < 0
#error GROUP_CONV2D_OUTPUT_RSHIFT must be bigger than 0
#endif
#if GROUP_CONV2D_BIAS_LSHIFT < 0
#error GROUP_CONV2D_BIAS_LSHIFT must be bigger than 0
#endif

/* weights for each layer */
static const int8_t group_conv2d_weights[] = GROUP_CONV2D_KERNEL_0;
static const nnom_weight_t group_conv2d_w = { (const void*)group_conv2d_weights, GROUP_CONV2D_OUTPUT_RSHIFT};
static const int8_t group_conv2d_bias[] = GROUP_CONV2D_BIAS_0;
static const nnom_bias_t group_conv2d_b = { (const void*)group_conv2d_bias, GROUP_CONV2D_BIAS_LSHIFT};

/* nnom model */
static int8_t nnom_input_data[32768];
static int8_t nnom_output_data[16384];
static nnom_model_t* nnom_model_create(void)
{
	static nnom_model_t model;
	nnom_layer_t* layer[3];

	new_model(&model);

	layer[0] = Input(shape(32, 32, 32), nnom_input_data);
	layer[1] = model.hook(GroupConv2D(16, 2, kernel(3, 3), stride(1, 1), dilation(1, 1), PADDING_SAME, &group_conv2d_w, &group_conv2d_b), layer[0]);
	layer[2] = model.hook(Output(shape(32, 32, 16), nnom_output_data), layer[1]);
	model_compile(&model, layer[0], layer[2]);
	return &model;
}
