#include "nnom.h"

#define CONV2D_KERNEL_0 {70, 66, -33, -57, 56, -44, 67, 3, -22, 47, -10, -69, 11, 55, -68, 39, -24, 55, -61, 71, 36, 50, -7, -15, -13, -32, -55, -14, 2, -34, 7, -33, -44, 11, 58, -51, 6, -69, -63, -37, -34, 14, -5, 38, -33, -8, -73, 14, -20, 62, 21, 42, 16, -67, 48, 74, -9, 34, -17, -5, 37, 2, 23, 69, 28, -41, -52, 1, 73, -67, 62, 72, 17, 28, 37, -61, -18, 26, 66, -56, 72, 70, -24, 56, 20, -38, 64, 29, 37, 42, -52, 60, 31, -41, 42, 36, -73, -46, 1, 59, -72, -43, 2, 48, -29, 51, 57, -2, -43, -25, 0, -24, 71, 8, 18, -2, -44, -56, 32, -39, 10, -13, -55, -70, -72, -70, -41, 1, 29, -54, -2, 27, -15, 35, -39, -56, 12, 22, 49, 17, 38, 4, 8, 72, -46, 26, 17, -23, 10, -15, -21, -57, 50, -20, -13, -32, 74, -66, 36, 73, 24, -68, -11, 6, -74, 16, -28, 33, -22, 67, -57, -9, 69, 33, 9, 67, 52, -39, 70, -21, 3, -51, -55, -45, -27, -3, -54, 60, 60, -57, -12, -48, -9, -39, -1, -57, -40, -8, 4, 26, 26, -24, -61, -46, 52, 49, -22, 49, -27, -61, 14, 12, 60, 13, -41, -24, -32, 62, -42, 50, -66, 14, -42, -16, 17, -61, -25, -72, 30, -46, -6, 21, -23, 72, 58, 41, -27, 9, 25, 51, 19, -2, -57, -15, -34, 23, -15, 24, 8, -66, -39, -63, 41, -1, 7, 58, -72, -59, -29, 11, 46, 61, 48, -2, 36, -31, -13, -28, -35, -62, 25, -60, -15, -11, 38, -26, -9, -10, -18, 56, -4, -27, -60, -36, -53, 72, 15, -48, -67, 1, -1, -64, -56, 48, 34, 24, -28, 62, -56, 7, 63, 8, 71, -19, -54, -36, -53, 45, -54, -11, 8, 53, -25, -49, -59, 35, -26, -52, 53, -69, -55, -49, 48, -25, 65, -8, 54, 49, 55, 69, -69, 27, -39, -9, -53, 17, -68, -49, -50, 40, 24, -34, -8, 39, 39, 23, 63, -7, 64, -65, -44, -47, 49, -45, -50, -56, -7, 24, -1, 7, 9, 51, 5, -30, -8, -71, -24, 48, 22, 53, -41, -9, -32, 30, -71, -26, -57, 73, -64, -11, 54, 32, 50, -31, 30, -61, 42, -26, 21, 16, 43, -5, -40, 42, -51, -55, 42, -71, 35, 38, -43, -72, -61, -23, 51, -5, 40, -47, -9, 19, -26, 57, -30, -62, 56, -57, 16, 57, 14, -54, 45, -59, 71, -72, -15, -67, 8, -59, -55, -8, 40, 55, 42, 58, 65, -1, 62, -56, -1, -45, 35, 10, 44, -63, 47, -11, -14, 18, 31, 1, -65, 29, -70, 21, -43, 45, 11, 59, 44, 73, 14, 70, -8, 20, 63, -47, -21, 9, -51, -73, -5, 44, 63, -6, 13, -35, 52, -15, 53, -73, 60, -8, -68, -71, 2, -6, -54, 24, -53, 53, 6, -20, -23, -34, 57, -25, -41, 36, -51, 16, 8, -20, -19, -50, 55, 14, 57, 7, -17, -1, -17, 17, 43, -46, 32, 31, 28, -19, 22, -64, 12, 48, -18, 28, 8, -57, 45, 29, 26, -13, 29, 55, -56, -59, 41, -35, -10, 38, -25, -31, 8, 20, 22, -41, -8, 69, 8, -71, 6, -4, 50, -2, -50, 71, 70, -18, -73, 50, -12, -62, 17, 22, -10, -13, -58, 7, 12, -38, 22, -53, -54, 29, -27, -21, -70, -9, -42, 55, 47, -74, -39, -3, 71, -56, 22, 15, 37, -36, -29, -63, 27, -41, 2, -17, -35, -49, 40, 33, 42, 41, 51, -47, 28, -61, -68, -57, 10, 71, 62, -7, 65, 10, -5, 71, 27, 2, 16, -51, -3, 70, 5, 9, 20, -65, -42, -32, 29, -35, -72, -65, 65, 12, 34, -67, -47, -15, -63, -71, -16, 9, 16, -34, -58, 68, -42, -19, -19, 43, -18, 43, -17, -73, 22, 74, -12, 8, -28, -36, -38, 42, 6, 44, 13, 15, 4, -9, -65, -11, -18, 63, -41, 71, -29, 36, 9, 2, -18, 21, -39, -16, -27, -1, 71, 73, -62, -14, -33, -22, -33, -46, -52, 65, -73, 43, -18, -13, -67, -33, 67, 6, -16, -8, -65, -15, 24, -66, 38, 5, -27, -47, 35, -2, -27, 8, 60, 61, 30, 5, -36, 43, -37, -68, -1, -68, -11, -8, 29, -35, 34, -20, -59, 37, 56, 63, -63, -26, 6, -69, -6, -8, -3, 50, -53, -21, 39, -10, 10, -23, 58, -25, 34, -51, -51, -15, 62, 5, -59, 7, -68, -2, -42, -16, 68, 49, -33, -71, 3, -1, -14, 52, -20, -37, -14, -23, 15, -11, 34, 63, -16, 32, -25, 7, -3, -28, -70, 64, -34, -12, -38, 73, 53, 43, -8, 0, 70, 47, -5, 36, 55, 11, -2, 23, 21, -33, -37, -50, -8, 20, -46, 65, 59, 43, 34, 67, 69, 36, -22, -18, 23, 61, 26, -24, 2, 73, 16, -53, -6, -47, -67, 15, -6, 51, -7, 0, 3, -26, 62, 69, -7, -74, 14, -66, 37, -10, 34, 63, -42, -69, 16, 52, -7, -13, 16, -63, -41, -62, -52, 59, 0, 22, -17, -6, 16, -3, -46, 37, -54, -61, -24, -10, 14, 71, -30, -49, 49, 6, -72, 50, -47, 47, 49, 33, 18, -18, 17, 73, -25, -53, -35, 55, 53, -28, -25, 13, -74, 60, -5, -26, 2, -16, 3, 7, -72, -11, -33, 47, 27, -34, 53, -65, 73, -18, -37, 15, -67, 16, 10, 25, -20, 59, 30, -62, 62, -2, 57, -3, -5, 33, -31, 65, 13, 15, -74, 41, -21, -54, -37, -19, -61, 62, 67, -72, 39, -14, 66, 51, -10, 35, -16, 4, 32, -64, -15, -4, -32, -58, -7, -54, -29, 60, -56, 21, 36, 46, 6, 73, -31, -32, -49, 62, -12, 9, -20, -37, -29, 62, -70, -18, -29, -1, 28, 62, 44, 33, 59, 49, 66, -4, -35, 31, 0, 68, -21, -34, -71, -21, 20, -45, 57, 56, 48, -29, 66, 40, 43, -69, 33, -54, -48, 55, 52, -54, 31, 49, -30, -34, 9, 51, 35, 70, -13, 13, 42, -6, 28, -54, 21, -7, 1, 5, 8, -69, 45, -36, 46, -41, 11, 53, -10, 10, -18, 60, 67, -69, 47, -53, 59, -18, 61, -7, -12, -50, -40, 45, 10, 9, -64, 36, 53, 32, -1, 34, 9, -20, -33, 36, -7, -29, 20, 34, 64, 40, -2, 22, 43, -30, -63, -4, -69, -21, -60, 70, 60, 18, -43, 11, 30, 48, 56, -26, -45, -13, -58, -16, -65, 45, -57, -45, -33, -8, -6, -64, -13, -46, -37, 29, 33, -34, 52, -9, -42, -31, -3, 21, 29, 62, 38, -20, -38, 11, -67, -5, 39, -53, 20, -35, 56, -64, -25, -16, -64, -63, -67, -59, -61, -3, -61, -8, 44, -49, -34, 5, -72, 17, -3, 0, 12, 27, -14, -69, 50, 16, 18, -50, -7, 5, -67, -67, 62, -2, 1, -41, 52, -32, 7, -24, 8, -20, 55, 55, 28, 71, -9, 17, -49, -7, 13, -5, -3, -57, 60, 22, 30, -25, -5, -20, -59, -30, -57, -26, -39, -35, -53, -15, -57, -8, -32, 32, -68, 69, 0, -57, 47, 62, -71, -22, 12, -10, -64, 0, 22, 48, 57, 44, 53, -22, 24, -72, -29, 11, -7, 36, -62, -41, 66, 19, -31, -34, -60, 54, -18, -44, 28, -68, -42, 65, 55, -2, -72, -19, -21, -10, -28, 26, 7, 41, -40, -30, 57, -69, 30, 25, 19, -73, 0, 65, -51, 18, 56, -19, 1, -35, 18, 44, -72, 18, 14, -59, 44, 39, -10, -41, 70, 64, -26, 68, -30, -20, -3, -71, 20, 69, 1, -63, 4, 59, -17, 21, 59, -53, -63, 15, 49, 52, -27, 72, 51, 27, -36, 32, 56, 10, -6, -66, -64, -3, -48, 56, -18, 9, -11, -58, 2, 53, -64, 32, 69, 71, -27, -45, 46, 3, -34, 36, -42, 6, -16, -56, -8, 24, 9, 13, -31, 38, 38, -9, -16, 29, 60, 48, 25, -40, 67, 14, 62, 17, 62, 29, -64, 17, -70, -31, 25, 71, 73, 37, 73, -58, -70, 22, -60, -8, -56, -70, -17, -36, 61, 45, 10, -64, -38, -13, -73, -59, 25, -24, 62, 45, -58, -13, 14, 55, -59, -1, -67, 26, 61, 42, 7, 48, -42, 42, 16, -36, -36, 44, 59, -17, 11, 9, 39, -51, 13, -68, 39, 16, 58, -9, -18, -16, 36, 49, 60, -64, 12, 17, 64, -8, -62, 13, 6, 35, 28, 12, 31, -39, 47, -13, -51, 2, -38, -26, -43, 53, -67, 16, 34, 64, -65, -12, 45, -14, 69, 56, 45, 49, 18, 27, 25, 54, -5, -18, 26, -58, 1, 47, -36, 18, -27, 58, -52, 56, -60, -9, 32, -51, -32, 51, 62, -65, 43, 17, -5, 60, 46, 3, -35, 69, -29, -5, 20, -39, 1, 63, -42, 74, 60, -8, 52, 15, -66, -29, 38, 40, 53, -60, 48, 14, 28, -68, -33, 66, -52, -56, 69, -36, -49, 11, -59, 72, -38, -28, -26, -37, 63, -53, 66, -71, 13, 55, -59, 67, 39, -42, 33, 25, -42, -41, -33, -16, 54, 60, -13, 34, 67, -17, -4, -10, -6, 32, 37, -56, -2, -59, 9, -32, -1, 14, -72, 15, 27, -2, -28, 57, -69, 66, 62, -20, 61, -43, 24, -9, -42, -66, -58, 42, -17, -25, -32, 38, -70, -65, 14, 51, 71, -14, -42, 62, 7, -5, -45, 6, -55, 61, 39, 59, 34, 12, -41, 60, 45, -56, -21, 59, -28, -61, 5, -44, 6, 40, 64, 44, -43, -17, 14, -24, 71, 9, 59, 42, -48, 67, 13, 72, -38, -2, -22, -27, -33, 39, 6, -60, 4, -62, 10, -5, -42, -65, 22, -34, 0, -61, -26, -53, -46, -26, -58, 5, 17, 9, 55, 44, 59, -44, -12, -55, -33, 8, -54, -66, 28, -4, 36, 54, 64, 12, -35, -64, -41, -42, -33, -3, -3, -68, -19, -47, -39, -3, 51, 39, -21, -46, 36, 72, -46, 5, 46, -7, -71, -16, 6, -33, -11, -70, -73, -9, -20, -26, -17, 47, -48, 67, -40, 8, 62, 13, 7, -25, -68, 71, -54, 14, 72, -54, -45, -44, 63, -47, 15, -30, -12, -70, 33, 23, 55, -29, 26, 28, -38, 8, 7, 24, 37, -26, -70, 24, 47, 18, -67, -58, 5, 34, -51, -31, -32, -30, 37, 64, -41, 62, -36, -38, 65, 21, -16, 46, 33, 48, -36, 60, -48, 18, -73, 53, -24, -5, -6, 8, 23, 60, 49, -16, 40, 65, 71, -20, 65, 1, 46, 65, -29, -38, 11, -50, -32, -21, -44, -69, 7, 44, -21, 2, -69, 10, 48, 57, 5, 24, -34, 19, 41, -39, 6, -46, 70, -74, 51, -14, 58, 50, 61, -62, -49, -32, -48, -52, 46, 53, 38, -1, -31, 47, -34, -42, -46, 56, -55, 9, -40, 65, 28, -25, -63, -70, 71, -26, -35, 63, -29, -31, -62, 71, -56, 0, 17, -41, -11, -12, -48, 40, -47, -42, 32, -73, -4, 15, 47, -57, -30, 11, 42, 64, -17, 43, 21, -20, -35, 18, -55, -18, 15, 65, -59, 51, -55, 36, 1, 0, -25, 11, 29, -12, -48, -8, -46, 12, 33, 6, -31, 32, -49, -66, -2, -13, -36, 30, 32, -29, 41, 12, -11, -2, -42, 52, -45, -26, -69, -28, 50, 30, -21, 13, -72, 2, -56, 49, -18, 52, 18, -14, -46, 24, -58, -65, 34, 33, -15, -2, -51, 43, -66, 34, -12, -12, -17, 16, -4, 27, 60, -66, -42, -11, 28, -69, -69, 55, 9, -17, -5, 0, -50, -17, 69, 20, -9, 30, -22, 2, -48, 50, -67, 6, 71, 0, 32, -32, 18, 30, 3, -39, -67, -45, 27, -55, 71, 37, -45, 38, -61, 50, -50, -17, -18, 68, -68, 43, 54, -67, -47, 70, 19, 21, -6, -7, -39, -17, 38, 38, -71, -51, -3, -52, 41, -59, 3, 71, 55, -23, 32, 23, -36, -63, -46, 18, -47, -27, 67, 11, 65, -63, 74, -15, -1, -53, 49, -58, -39, 48, 39, 53, -25, -28, -46, 65, 53, -45, -41, -59, 26, 6, -22, -21, -48, 64, -50, 17, -1, -2, -29, -43, 35, 71, -66, 12, -56, 47, 13, -34, -54, 22, 44, -27, -50, -54, -41, -52, -31, -43, 17, 8, -53, -35, 31, -16, -26, -63, 31, 64, -19, -62, 28, 55, -68, 29, 17, 11, 8, 3, -11, -18, -68, -70, 69, 25, -61, 63, 63, 74, 16, -54, -32, -66, -51, -44, -34, 69, 23, 20, -63, 32, -41, -51, -9, 55, 55, -47, 45, 0, 13, 47, 7, -41, -71, 18, -8, -16, 1, 6, -21, 65, 64, 44, 26, 30, -40, -41, -58, -27, -66, -23, -17, -62, -72, 29, 19, -9, -48, -13, 14, 21, -71, 24, -69, -5, -21, 64, 40, -63, 72, -39, -11, -39, 61, -25, 10, 61, 21, -56, -11, -53, -62, 32, 4, 48, 6, -56, 59, -13, 52, -47, 14, 21, 50, 24, 2, -52, 7, 12, 56, 26, -52, -74, -66, -48, 68, 55, -34, -68, -45, 7, 52, 59, -63, -3, 2, -69, -23, -17, 32, 19, -59, -51, -4, -17, 4, 12, 64, -3, 19, -18, 72, 47, -34, -26, -64, 62, 40, -50, -1, 30, -69, 50, -51, -51, 34, -14, 53, -26, 70, -47, 50, -27, 15, -37, 7, -23, -69, -36, 43, 32, 35, 14, 50, 53, 23, -8, -40, -30, 25, -35, -54, -69, -9, 43, 42, -31, 30, 62, -23, 27, 24, -49, 50, 64, -34, -22, 2, -18, 5, -46, -55, -56, -6, -13, -64, 11, -5, 54, -64, 32, 45, 41, 70, -61, 16, -28, 19, -5, -33, 17, -8, 73, 26, 58, 13, 12, 27, -40, 31, -65, -67, -43, -57, 26}

#define CONV2D_KERNEL_0_SHIFT (9)

#define CONV2D_BIAS_0 {45, 51, 110, -9, 67, 0, -43, 103, 95, -97, 86, -91, -81, -25, 82, 110}

#define CONV2D_BIAS_0_SHIFT (8)


/* output enconding for each layer */
#define INPUT_1_OUTPUT_SHIFT 7
#define CONV2D_OUTPUT_SHIFT 5

/* bias shift and output shift for each layer */
#define CONV2D_OUTPUT_RSHIFT (INPUT_1_OUTPUT_SHIFT+CONV2D_KERNEL_0_SHIFT-CONV2D_OUTPUT_SHIFT)
#define CONV2D_BIAS_LSHIFT   (INPUT_1_OUTPUT_SHIFT+CONV2D_KERNEL_0_SHIFT-CONV2D_BIAS_0_SHIFT)
#if CONV2D_OUTPUT_RSHIFT < 0
#error CONV2D_OUTPUT_RSHIFT must be bigger than 0
#endif
#if CONV2D_BIAS_LSHIFT < 0
#error CONV2D_BIAS_LSHIFT must be bigger than 0
#endif

/* weights for each layer */
static const int8_t conv2d_weights[] = CONV2D_KERNEL_0;
static const nnom_weight_t conv2d_w = { (const void*)conv2d_weights, CONV2D_OUTPUT_RSHIFT};
static const int8_t conv2d_bias[] = CONV2D_BIAS_0;
static const nnom_bias_t conv2d_b = { (const void*)conv2d_bias, CONV2D_BIAS_LSHIFT};

/* nnom model */
static int8_t nnom_input_data[16384];
static int8_t nnom_output_data[16384];
static nnom_model_t* nnom_model_create(void)
{
	static nnom_model_t model;
	nnom_layer_t* layer[3];

	new_model(&model);

	layer[0] = Input(shape(32, 32, 16), nnom_input_data);
	layer[1] = model.hook(Conv2D(16, kernel(3, 3), stride(1, 1), dilation(1, 1), PADDING_SAME, &conv2d_w, &conv2d_b), layer[0]);
	layer[2] = model.hook(Output(shape(32, 32, 16), nnom_output_data), layer[1]);
	model_compile(&model, layer[0], layer[2]);
	return &model;
}
